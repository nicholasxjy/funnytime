/*! funnytime - v0.0.1 - 2014-07-11 */
$(document).ready(function(){$(".nav-tooltip").tooltip(),$(".info-popover").popover(),Dropzone.options.myDropzone={url:"/create/new",method:"post",paramName:"file",maxFilesize:10,parallelUploads:10,acceptedFiles:"image/*",addRemoveLinks:!0,autoProcessQueue:!1,uploadMultiple:!0,init:function(){var a=document.getElementById("modal-post-btn"),b=document.getElementById("attachment-link"),c=document.getElementById("attachment-video"),d=this;a.addEventListener("click",function(a){var b=$("#share-what-new").val(),c=$("#share-link").val(),e=$("#video-input").val(),f=$("#authorize-select").val(),g=$("#puzzle-input").val(),h=$("#puzzle-answer").val();$("#hiddencontent").val(b),$("#hiddenlink").val(c),$("#hiddenvideo").val(e),$("#hiddenselect").val(f),$("#hiddenquestion").val(g),$("#hiddenanswer").val(h),a.stopPropagation(),d.files&&0!==d.files.length&&""===c&&""===e?d.processQueue():$("#my-dropzone").submit()}),b.addEventListener("click",function(){var a=$("#share-what-new").val();d.removeAllFiles(),""!==a?$("#modal-post-btn").removeAttr("disabled"):$("#modal-post-btn").attr("disabled","disabled")}),c.addEventListener("click",function(){var a=$("#share-what-new").val();d.removeAllFiles(),""!==a?$("#modal-post-btn").removeAttr("disabled"):$("#modal-post-btn").attr("disabled","disabled")}),this.on("addedfile",function(a){a&&$("#modal-post-btn").removeAttr("disabled")}),this.on("removedfile",function(){var a=$("#share-what-new").val();0===d.files.length&&""===a&&$("#modal-post-btn").attr("disabled","disabled")}),this.on("successmultiple",function(a,b){"fail"===b.status?($("#post-warning").html(""),$("#post-warning").html('<div class="alert alert-warning fade in" role="alert"><button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button><strong>Oops!</strong> '+b.error+"</div>"),$(".alert").alert()):window.location.href="http://127.0.0.1:1337"})}},$(".attach-photo-link").on("click",function(){$("#link-wrap").hide(),$("#video-wrap").hide(),$("#share-link").val(""),$("#video-input").val(""),$("#dropzone-wrap").show()}),$(".attach-link-link").on("click",function(){$("#dropzone-wrap").hide(),$("#video-wrap").hide(),$("#video-input").val(""),$("#link-wrap").show()}),$(".attach-video-link").on("click",function(){$("#dropzone-wrap").hide(),$("#link-wrap").hide(),$("#share-link").val(""),$("#video-wrap").show()}),$(".attach-link-cancel").on("click",function(){$(".attach-link-input").val("")}),$(".video-input-cancel").on("click",function(){$("#video-input").val("")}),$(".puzzle-input-cancel").on("click",function(){$("#puzzle-input").val(""),$("#puzzle-input").html("")}),$(".puzzle-answer-cancel").on("click",function(){$("#puzzle-answer").val("")}),$("#authorize-select").on("change",function(){var a=$(this).val();"0"!==a?$(".question-wrap").show():$(".question-wrap").hide()}),$("#share-what-new, #share-link, #video-input").on("keyup",function(){var a=$(this).val();a&&""!==a?$("#modal-post-btn").removeAttr("disabled"):$("#modal-post-btn").attr("disabled","disabled")}),$(".setting-btn-submit").on("click",function(){$(".setting-form-wrap").find("form").submit()}),$(".follow-btn").on("click",function(){var a=$(this),b=a.data("userid"),c=a.data("action"),d=$(".following-users-count").text();d=parseInt(d),$.ajax({url:"/u/follow",type:"POST",dataType:"json",data:{userid:b,action:c},success:function(b){"success"===b.status&&("follow"===c?(a.text("已关注").removeClass("btn-info").addClass("btn-danger"),a.data("action","unfollow")):(a.text("加入关注").removeClass("btn-danger").addClass("btn-info"),a.data("action","follow")))},error:function(){alert("Oops, something gose wrong here!")}})}),$("#post-search-btn").on("click",function(){var a=$(".search-input").val();""===a.trim()?$(".search-input").attr("placeholder","please input the friend's name"):$("#search-form").submit()}),$("#btt").on("click",function(){var a=$(this).offset();a&&$("html, body").animate({scrollTop:0},1e3)})}),$(document).ready(function(){$("#btn-signin").click(function(){var a=$("#signin-wrap"),b=a.find('input[name="name"]').val(),c=a.find('input[name="pass"]').val();$.ajax({url:"/signin",type:"POST",data:{name:b,pass:c},dataType:"json",async:!1,success:function(b){"fail"===b.status?(a.find(".error").html(""),a.find(".error").html('<div class="alert alert-warning fade in" role="alert"><button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button><strong>Oops!</strong> '+b.error+"</div>"),$(".alert").alert()):window.location.href="http://127.0.0.1:1337"},error:function(){a.find(".error").html(""),a.find(".error").html('<div class="alert alert-warning fade in" role="alert"><button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button><strong>Holy Shit!</strong> Something goes wrong here!</div>'),$(".alert").alert()}})}),$("#btn-signup").click(function(){var a=$("#signup-wrap"),b=a.find('input[name="name"]').val(),c=a.find('input[name="email"]').val(),d=a.find('input[name="pass"]').val(),e=a.find('input[name="repass"]').val();$.ajax({url:"/signup",type:"POST",data:{name:b,email:c,pass:d,repass:e},dataType:"json",async:!1,success:function(b){"fail"===b.status?(a.find(".error").html(""),a.find(".error").html('<div class="alert alert-warning fade in" role="alert"><button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button><strong>Oops!</strong> '+b.error+"</div>"),$(".alert").alert()):(a.find(".success").html(""),a.find(".success").html('<div class="alert alert-success fade in" role="alert"><button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button><strong>All right!</strong> '+b.success+"</div>"),$(".alert").alert())},error:function(){a.find(".error").html(""),a.find(".error").html('<div class="alert alert-warning fade in" role="alert"><button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button><strong>Holy Shit!</strong> Something goes wrong here!</div>'),$(".alert").alert()}})})}),$(document).ready(function(){$(".delegate-symbol").on("click",".comment-show",function(){var a=$(this).data("itemid"),b=$("#joke"+a+"-comments"),c=b.css("display");"none"===c?(b.show(),$(this).find("b").text("收起评论")):(b.hide(),$(this).find("b").text("展开评论"))}),$(".delegate-symbol").on("click",".comment-reply",function(){var a=$(this).parents(".content-bottom"),b=a.parents(".delegate-need-index").data("index"),c=a.data("userid"),d=a.data("jokeid"),e=a.data("username"),f=a.data("useravatar"),g=a.data("posttime"),h=a.data("postcontent")||"",i='<div class="modal fade" id="comment-post-modal" tabindex="-1" role="dialog" aria-labelledby="myPostModalLabel" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button><h4 class="modal-title" id="myModalLabel">回复@'+e+'</h4></div><div class="modal-body"><div class="modal-comment-item"><div class="modal-comment-inner-left"><img class="img-rounded img-responsive nav-tooltip" src="'+f+'" title="'+e+'" width="48" height="48"></div><div class="modal-comment-inner-right"><div class="author-information"><a href="/u/'+e+'"><strong class="fullname">'+e+'</strong></a><small class="create-time"><a class="nav-tooltip" href="/u/'+e+'">'+g+"</a></small></div><p>"+h+'</p></div></div><div class="comment-input-area"><textarea class="share-words" row="3">@'+e+' </textarea></div></div><div class="modal-footer"><button type="button" data-index="'+b+'" data-toname="'+e+'" data-jokeid="'+d+'" data-toid="'+c+'" class="btn btn-primary btn-post-comment" disabled="disabled"><i class="fa fa-pencil-square-o"></i></button></div></div></div></div>';$("#comment-post-modal").remove(),$(".wrap").append(i),$("#comment-post-modal").find("textarea").on("keyup",function(){var a=$("#comment-post-modal").find(".btn-post-comment"),b=a.data("toname"),c=$(this).val();-1!==c.indexOf("@"+b+" ")?(c=c.replace("@"+b+" ",""),""!==c?a.removeAttr("disabled"):a.attr("disabled","disabled")):a.attr("disabled","disabled")}),$(".btn-post-comment").on("click",function(){var a=$(this).parents("#comment-post-modal").find(".comment-input-area").find("textarea"),b=$(this).data("jokeid"),c=($(this).data("toname"),$(this).data("toid")),d=a.val(),e=$(this).data("index");$.ajax({url:"/comment/new",type:"POST",dataType:"json",data:{jokeid:b,toid:c,content:d},success:function(a){if("success"===a.status){$("#comment-post-modal").modal("hide");var c='<div class="comment-item"><div class="comment-item-inner-left"><img class="img-rounded img-responsive nav-tooltip" src="'+a.info.gravatar+'" data-toggle="tooltip" title="'+a.info.name+'" width="32" height="32"></div><div class="comment-item-inner-right"><div class="author-information"><a href="/u/'+a.info.name+'"><strong class="fullname">'+a.info.name+'</strong></a><small class="create-time"><a class="nav-tooltip" href="/u/'+a.info.name+'">刚刚</a></small></div><p>'+d+'</p><div class="content-bottom" data-index="'+e+'" data-jokeid="'+b+'" data-userid="'+a.info.userid+'" data-username="'+a.info.name+'" data-useravatar="'+a.info.gravatar+'" data-posttime="刚刚" data-postcontent="'+d+'"><ul class="list-inline fun-list"><li><a class="comment-reply"><i class="fa fa-reply"></i><b>回复</b></a></li><li><a href="#"><i class="fa fa-heart"></i><b>点赞</b></a></li><li><a href="#"><i class="fa fa-hand-o-down"></i><b>差评</b></a></li><li><a href="#"><i class="fa fa-star"></i><b>收藏</b></a></li></ul></div></div></div>';$("#joke"+e+"-comments").prepend(c),$("#joke"+e+"-comments").show()}},error:function(){alert("Something goes wrong here!")}})}),$("#comment-post-modal").modal()}),$(".delegate-symbol").on("click",".joke-like-btn",function(){var a=$(this),b=a.parents(".content-bottom"),c=b.data("jokeid"),d=a.data("action");c&&$.ajax({url:"/joke/like",type:"POST",dataType:"json",data:{jokeid:c,action:d},success:function(b){"success"===b.status&&("like"===d?(a.addClass("islike"),a.data("action","cancel-like"),a.find("b").text(b.like_count),a.attr("data-original-title","取消")):(a.removeClass("islike"),a.data("action","like"),a.find("b").text(b.like_count),a.attr("data-original-title","点赞")))},error:function(){alert("Oops, something goes wrong here!")}})}),$(".delegate-symbol").on("click",".joke-dislike-btn",function(){var a=$(this),b=a.parents(".content-bottom"),c=b.data("jokeid"),d=a.data("action");c&&$.ajax({url:"/joke/dislike",type:"POST",dataType:"json",data:{jokeid:c,action:d},success:function(b){"success"===b.status&&("dislike"===d?(a.addClass("isdislike"),a.data("action","cancel-dislike"),a.find("b").text(b.dislike_count),a.attr("data-original-title","取消")):(a.removeClass("isdislike"),a.data("action","dislike"),a.find("b").text(b.dislike_count),a.attr("data-original-title","差评")))},error:function(){alert("Oops, something goes wrong here!")}})}),$(".notification-check-delegate").on("click",".check-notification",function(){var a=$(this),b=a.data("notificationid");$.ajax({url:"notification/check",type:"POST",dataType:"json",data:{notificationid:b},success:function(b){if("success"===b.status){a.parents(".notification-check-delegate").addClass("has-checked");var c=$(".notifition-count").text();c=parseInt(c),c-=1,0>=c?$(".notifition-count").remove():$(".notifition-count").text(c),a.remove()}},error:function(){alert("Oops, something goes wrong here!")}})}),$(".check-all-notification").on("click",function(){$.ajax({url:"notificationcheck/all",type:"POST",dataType:"json",success:function(a){"success"===a.status&&(window.location.href=location.href)},error:function(){alert("Oops, something goes wrong here!")}})}),$(".delegate-symbol").on("click",".collection-btn",function(){var a=$(this),b=a.data("jokeid"),c=a.data("action");$.ajax({url:"/collect",type:"POST",dataType:"json",data:{jokeid:b,action:c},success:function(b){"success"===b.status?"collect"===c?(a.css("color","#ffac33"),a.attr("data-original-title","取消"),a.data("action","uncollect")):(a.css("color","#8899a6"),a.attr("data-original-title","收藏"),a.data("action","collect")):alert("Oops, something goes wrong here!")},error:function(){alert("Oops, something goes wrong here!")}})})});